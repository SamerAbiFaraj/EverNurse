{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/EverNurse-Project/evernurse-cv-matcher/src/app/api/jobs/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { readFile, writeFile } from 'fs/promises';\r\nimport { existsSync } from 'fs';\r\n\r\n// Database file path\r\nconst DB_PATH = './uploads/database.json';\r\n\r\n// Initialize database if it doesn't exist\r\nasync function initDatabase() {\r\n    if (!existsSync(DB_PATH)) {\r\n        const initialDb = {\r\n            candidates: [],\r\n            matches: [],\r\n            jobs: []\r\n        };\r\n        await writeFile(DB_PATH, JSON.stringify(initialDb, null, 2));\r\n        return initialDb;\r\n    }\r\n    const data = await readFile(DB_PATH, 'utf-8');\r\n    return JSON.parse(data);\r\n}\r\n\r\n// GET /api/jobs - List all jobs\r\nexport async function GET(request: NextRequest) {\r\n    try {\r\n        const db = await initDatabase();\r\n\r\n        // Get query params\r\n        const { searchParams } = new URL(request.url);\r\n        const activeOnly = searchParams.get('active') === 'true';\r\n\r\n        let jobs = db.jobs || [];\r\n\r\n        // Filter active jobs if requested\r\n        if (activeOnly) {\r\n            jobs = jobs.filter((job: any) => job.isActive !== false);\r\n        }\r\n\r\n        // Sort by creation date (newest first)\r\n        jobs.sort((a: any, b: any) => {\r\n            const dateA = new Date(a.createdAt || 0).getTime();\r\n            const dateB = new Date(b.createdAt || 0).getTime();\r\n            return dateB - dateA;\r\n        });\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            jobs,\r\n            count: jobs.length\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('❌ Error fetching jobs:', error);\r\n        return NextResponse.json(\r\n            { error: 'Failed to fetch jobs' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\n// POST /api/jobs - Create new job\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const body = await request.json();\r\n\r\n        // Validate required fields\r\n        const requiredFields = ['title', 'department', 'location', 'description'];\r\n        for (const field of requiredFields) {\r\n            if (!body[field]) {\r\n                return NextResponse.json(\r\n                    { error: `Missing required field: ${field}` },\r\n                    { status: 400 }\r\n                );\r\n            }\r\n        }\r\n\r\n        // Read database\r\n        const db = await initDatabase();\r\n        if (!db.jobs) db.jobs = [];\r\n\r\n        // Create new job\r\n        const newJob = {\r\n            id: `job-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n            title: body.title,\r\n            department: body.department,\r\n            location: body.location,\r\n            description: body.description,\r\n            requiredSkills: body.requiredSkills || [],\r\n            preferredSkills: body.preferredSkills || [],\r\n            requiredLicenses: body.requiredLicenses || [],\r\n            minExperience: body.minExperience || 0,\r\n            matchThreshold: body.matchThreshold || 70,\r\n            isActive: body.isActive !== undefined ? body.isActive : true,\r\n            salaryRange: body.salaryRange || null,\r\n            benefits: body.benefits || [],\r\n            createdAt: new Date().toISOString(),\r\n            updatedAt: new Date().toISOString()\r\n        };\r\n\r\n        // Add to database\r\n        db.jobs.push(newJob);\r\n\r\n        // Save database\r\n        await writeFile(DB_PATH, JSON.stringify(db, null, 2));\r\n\r\n        console.log(`✅ Created job: ${newJob.title} (${newJob.id})`);\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            job: newJob,\r\n            message: 'Job created successfully'\r\n        }, { status: 201 });\r\n\r\n    } catch (error) {\r\n        console.error('❌ Error creating job:', error);\r\n        return NextResponse.json(\r\n            { error: 'Failed to create job' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,qBAAqB;AACrB,MAAM,UAAU;AAEhB,0CAA0C;AAC1C,eAAe;IACX,IAAI,CAAC,IAAA,2GAAU,EAAC,UAAU;QACtB,MAAM,YAAY;YACd,YAAY,EAAE;YACd,SAAS,EAAE;YACX,MAAM,EAAE;QACZ;QACA,MAAM,IAAA,kIAAS,EAAC,SAAS,KAAK,SAAS,CAAC,WAAW,MAAM;QACzD,OAAO;IACX;IACA,MAAM,OAAO,MAAM,IAAA,iIAAQ,EAAC,SAAS;IACrC,OAAO,KAAK,KAAK,CAAC;AACtB;AAGO,eAAe,IAAI,OAAoB;IAC1C,IAAI;QACA,MAAM,KAAK,MAAM;QAEjB,mBAAmB;QACnB,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,aAAa,aAAa,GAAG,CAAC,cAAc;QAElD,IAAI,OAAO,GAAG,IAAI,IAAI,EAAE;QAExB,kCAAkC;QAClC,IAAI,YAAY;YACZ,OAAO,KAAK,MAAM,CAAC,CAAC,MAAa,IAAI,QAAQ,KAAK;QACtD;QAEA,uCAAuC;QACvC,KAAK,IAAI,CAAC,CAAC,GAAQ;YACf,MAAM,QAAQ,IAAI,KAAK,EAAE,SAAS,IAAI,GAAG,OAAO;YAChD,MAAM,QAAQ,IAAI,KAAK,EAAE,SAAS,IAAI,GAAG,OAAO;YAChD,OAAO,QAAQ;QACnB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT;YACA,OAAO,KAAK,MAAM;QACtB;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAEtB;AACJ;AAGO,eAAe,KAAK,OAAoB;IAC3C,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,2BAA2B;QAC3B,MAAM,iBAAiB;YAAC;YAAS;YAAc;YAAY;SAAc;QACzE,KAAK,MAAM,SAAS,eAAgB;YAChC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBACd,OAAO,gJAAY,CAAC,IAAI,CACpB;oBAAE,OAAO,CAAC,wBAAwB,EAAE,OAAO;gBAAC,GAC5C;oBAAE,QAAQ;gBAAI;YAEtB;QACJ;QAEA,gBAAgB;QAChB,MAAM,KAAK,MAAM;QACjB,IAAI,CAAC,GAAG,IAAI,EAAE,GAAG,IAAI,GAAG,EAAE;QAE1B,iBAAiB;QACjB,MAAM,SAAS;YACX,IAAI,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;YAClE,OAAO,KAAK,KAAK;YACjB,YAAY,KAAK,UAAU;YAC3B,UAAU,KAAK,QAAQ;YACvB,aAAa,KAAK,WAAW;YAC7B,gBAAgB,KAAK,cAAc,IAAI,EAAE;YACzC,iBAAiB,KAAK,eAAe,IAAI,EAAE;YAC3C,kBAAkB,KAAK,gBAAgB,IAAI,EAAE;YAC7C,eAAe,KAAK,aAAa,IAAI;YACrC,gBAAgB,KAAK,cAAc,IAAI;YACvC,UAAU,KAAK,QAAQ,KAAK,YAAY,KAAK,QAAQ,GAAG;YACxD,aAAa,KAAK,WAAW,IAAI;YACjC,UAAU,KAAK,QAAQ,IAAI,EAAE;YAC7B,WAAW,IAAI,OAAO,WAAW;YACjC,WAAW,IAAI,OAAO,WAAW;QACrC;QAEA,kBAAkB;QAClB,GAAG,IAAI,CAAC,IAAI,CAAC;QAEb,gBAAgB;QAChB,MAAM,IAAA,kIAAS,EAAC,SAAS,KAAK,SAAS,CAAC,IAAI,MAAM;QAElD,QAAQ,GAAG,CAAC,CAAC,eAAe,EAAE,OAAO,KAAK,CAAC,EAAE,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC;QAE3D,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,KAAK;YACL,SAAS;QACb,GAAG;YAAE,QAAQ;QAAI;IAErB,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}